(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (Buffer){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var src_1=require("../src"),tslib_1=require("tslib"),mock,digest,randombytes;beforeEach(function(){function e(e,t,n,i,r,o){o(null,digest)}digest=Buffer.alloc(64),randombytes=Buffer.alloc(64),mock={pbkdf2:jasmine.createSpy("pbkdf2").and.callFake(e),randombytes:jasmine.createSpy("randombytes").and.returnValue(randombytes)}}),describe("getPbkdf2Sha512 (config?: Partial<Pbkdf2Sha512Config>): (password: Buffer|string) => Promise<Pbkdf2sha512Digest>",function(){it("returns a function",function(){expect(src_1.default()).toEqual(jasmine.any(Function))}),describe("when called without args",function(){var e;beforeEach(function(t){src_1.default(mock)("passphrase").then(function(t){return e=t}).then(function(){return setTimeout(t)}).catch(function(e){return setTimeout(function(){return t.fail(e)})})}),it("configures the returned pbkdf2 function with the following defaults: random salt string of 64 bytes, base64 encoding, 65536 iterations, digest length of 64 bytes, sha512 hmac",function(){expect(mock.pbkdf2).toHaveBeenCalledWith(jasmine.any(Buffer),randombytes,65536,64,"sha512",jasmine.any(Function)),expect(mock.randombytes).toHaveBeenCalledWith(64),expect(e.spec.encoding).toBe("base64")})}),describe("when called with a valid config object",function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({encoding:"ascii",salt:Buffer.alloc(32),iterations:8192,length:32},mock),src_1.default(e)("passphrase").then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("configures the returned pbkdf2 function with the properties of the config object",function(){expect(mock.pbkdf2).toHaveBeenCalledWith(jasmine.any(Buffer),e.salt,e.iterations,e.length,"sha512",jasmine.any(Function)),expect(mock.randombytes).not.toHaveBeenCalled(),expect(t.spec.encoding).toBe(e.encoding)})}),describe("when called with an invalid config object, or a config object with invalid properties",function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({encoding:"foo",salt:Buffer.alloc(31),iterations:8191,length:31},mock),src_1.default(e)("passphrase").then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("configures the returned pbkdf2 function of each invalid property to its default value",function(){expect(mock.pbkdf2).toHaveBeenCalledWith(jasmine.any(Buffer),randombytes,65536,64,"sha512",jasmine.any(Function)),expect(mock.randombytes).toHaveBeenCalledWith(64),expect(t.spec.encoding).toBe("base64")})}),describe("when called with `relaxed: true`",function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({iterations:1,relaxed:!0},mock),src_1.default(e)("passphrase").then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("accepts any strictly positive iteration count",function(){expect(mock.pbkdf2).toHaveBeenCalledWith(jasmine.any(Buffer),randombytes,1,64,"sha512",jasmine.any(Function)),expect(mock.randombytes).toHaveBeenCalledWith(64),expect(t.spec.encoding).toBe("base64")})})}),describe("pbkdf2Sha512 (password: Buffer|Uint8Array|string) => Promise<Pbkdf2sha512Digest>",function(){describe("when called with a string, Buffer, or Uint8Array",function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({encoding:"ascii"},mock);var i=Buffer.from("passphrase","ascii"),r=new Uint8Array(i.buffer),o=["passphrase",i,r],a=src_1.default(e);Promise.all(o.map(function(e){return a(e)})).then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("returns the pbkdf2 digest of the given argument together with the corresponding pbkdf2 parameters",function(){mock.pbkdf2.calls.allArgs().every(function(e){return expect(e[0].toString()).toBe("passphrase")}),t.every(function(e){return expect(e.value.toString("ascii")).toBe(digest.toString())&&expect(e.spec).toEqual({encoding:"ascii",salt:randombytes.toString(),iterations:65536,length:64})})})}),describe('when instantiated with `{ encoding: "none" }`',function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({encoding:"none"},mock);var i=Buffer.from("passphrase","ascii"),r=new Uint8Array(i.buffer),o=["passphrase",i,r],a=src_1.default(e);Promise.all(o.map(function(e){return a(e)})).then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it("returns the raw (Buffer) pbkdf2 digest of the given argument together with the corresponding pbkdf2 parameters",function(){mock.pbkdf2.calls.allArgs().every(function(e){return expect(e[0].toString()).toBe("passphrase")}),t.every(function(e){return expect(e.value).toEqual(digest)&&expect(e.spec).toEqual({encoding:"none",salt:randombytes.toString(),iterations:65536,length:64})})})}),describe("when called with anything else",function(){var e,t;beforeEach(function(n){e=tslib_1.__assign({encoding:"ascii"},mock);var i=[null,void 0,42,[],{}],r=src_1.default(e);Promise.all(i.map(function(e){return r(e).catch(function(e){return e})})).then(function(e){return t=e}).then(function(){return setTimeout(n)}).catch(function(e){return setTimeout(function(){return n.fail(e)})})}),it('throws an "invalid arguments" TypeError',function(){t.every(function(e){return expect(e).toEqual(jasmine.any(TypeError))&&expect(e.message).toBe("invalid argument")})})})});
}).call(this,require("buffer").Buffer)
},{"../src":2,"buffer":undefined,"tslib":undefined}],2:[function(require,module,exports){
(function (Buffer){
"use strict";function getPbkdf2Sha512Spec(t,e){var n=tslib_1.__assign({},e),r=getEncoding(n.encoding),i=getSaltBuffer(t,n.salt,r),f={encoding:r,salt:{bytes:i},iterations:getIterations(n.iterations,n.relaxed),length:getLength(n.length)};return"none"!==r&&(f.salt.chars=i.toString(r)),f}function getSaltBuffer(t,e,n){var r=toBufferIfUintArray(toRandomBufferIfNumber(t,toBufferIfString(e,n)));return Buffer.isBuffer(r)&&r.length>=PBKDF2_CONFIG_DEFAULTS.salt.min?Buffer.from(r):t(PBKDF2_CONFIG_DEFAULTS.salt.default)}function toRandomBufferIfNumber(t,e){return utils_1.isNumber(e)?t(e.valueOf()):e}function toBufferIfUintArray(t){try{return t&&utils_1.isArrayBuffer(t.buffer)?Buffer.from(t.buffer):t}catch(e){return t}}function getEncoding(t){var e=utils_1.isString(t)&&t.valueOf();return PBKDF2_CONFIG_DEFAULTS.encoding.indexOf(e)>=0?e:PBKDF2_CONFIG_DEFAULTS.encoding[0]}function getIterations(t,e){var n=utils_1.isNumber(t)&&Math.floor(t.valueOf()),r=e?1:PBKDF2_CONFIG_DEFAULTS.iterations.min;return t>=r?n:PBKDF2_CONFIG_DEFAULTS.iterations.default}function getLength(t){var e=utils_1.isNumber(t)&&t.valueOf();return t>=PBKDF2_CONFIG_DEFAULTS.length.min&&t<=PBKDF2_CONFIG_DEFAULTS.length.max?e:PBKDF2_CONFIG_DEFAULTS.length.default}function toBufferIfString(t,e){return"none"!==e&&utils_1.isString(t)?Buffer.from(t.valueOf(),e):t}Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),utils_1=require("./utils"),PBKDF2_CONFIG_DEFAULTS={encoding:["base64","utf8","latin1","binary","ascii","hex","none"],salt:{default:64,min:32},iterations:{default:65536,min:8192},length:{default:64,min:32,max:64}},Pbkdf2Sha512Class=function(){function t(t,e,n,r,i){this.pbkdf2=t,this.encoding=e,this.salt=n,this.iterations=r,this.length=i,this.hmac="sha512"}return t.prototype.hash=function(t){var e=this,n={encoding:this.encoding,salt:this.salt.chars||this.salt.bytes,iterations:this.iterations,length:this.length,hmac:this.hmac};return new Promise(function(r,i){e.pbkdf2(t,e.salt.bytes,e.iterations,e.length,e.hmac,function(t,f){t&&i(t);var a={value:"none"===e.encoding?f:f.toString(e.encoding),spec:n};r(a)})})},t}();Pbkdf2Sha512Class.getKdf=function(t){var e=t&&t.pbkdf2||require("pbkdf2").pbkdf2,n=t&&t.randombytes||require("randombytes"),r=getPbkdf2Sha512Spec(n,t),i=new Pbkdf2Sha512Class(e,r.encoding,r.salt,r.iterations,r.length);return function(t){var e=toBufferIfUintArray(toBufferIfString(t,"utf8"));return Buffer.isBuffer(e)?i.hash(e):Promise.reject(new TypeError("invalid password"))}};var getPbkdf2Sha512=Pbkdf2Sha512Class.getKdf;exports.default=getPbkdf2Sha512;
}).call(this,require("buffer").Buffer)
},{"./utils":3,"buffer":undefined,"pbkdf2":undefined,"randombytes":undefined,"tslib":undefined}],3:[function(require,module,exports){
"use strict";function isString(r){return"string"==typeof(r&&r.valueOf())}function isNumber(r){return"number"==typeof(r&&r.valueOf())}function isArrayBuffer(r){return"[object ArrayBuffer]"===Object.prototype.toString.call(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isString=isString,exports.isNumber=isNumber,exports.isArrayBuffer=isArrayBuffer;
},{}]},{},[1]);
